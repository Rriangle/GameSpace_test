<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小遊戲系統 - GameSpace</title>
  <style>
    :root {
      --bg: #f8f9fa;
      --surface: #ffffff;
      --text: #212529;
      --muted: #6c757d;
      --line: #dee2e6;
      --accent: #007bff;
      --accent-hover: #0056b3;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --info: #17a2b8;
      --shadow: 0 2px 4px rgba(0,0,0,0.1);
      --shadow-lg: 0 4px 8px rgba(0,0,0,0.15);
      --radius: 8px;
      --radius-lg: 12px;
      --blur: 8px;
      --spacing: 16px;
      --spacing-sm: 8px;
      --spacing-lg: 24px;
    }

    body.dark {
      --bg: #1a1a1a;
      --surface: #2d2d2d;
      --text: #ffffff;
      --muted: #adb5bd;
      --line: #495057;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
    
    .container { max-width: 1200px; margin: 0 auto; padding: var(--spacing); }
    
    .header { background: var(--surface); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); box-shadow: var(--shadow); }
    .header h1 { font-size: 2rem; margin-bottom: var(--spacing-sm); }
    .header p { color: var(--muted); }
    
    .nav { display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); }
    .nav a { padding: var(--spacing-sm) var(--spacing); background: var(--surface); border-radius: var(--radius); text-decoration: none; color: var(--text); box-shadow: var(--shadow); transition: all 0.2s; }
    .nav a:hover { background: var(--accent); color: white; }
    
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-lg); }
    .card { background: var(--surface); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow); }
    .card h3 { margin-bottom: var(--spacing); color: var(--accent); }
    
    .game-status { text-align: center; padding: var(--spacing-lg); background: linear-gradient(135deg, var(--accent), var(--info)); color: white; border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg); }
    .game-status h2 { font-size: 2rem; margin-bottom: var(--spacing-sm); }
    .game-status p { opacity: 0.9; }
    
    .game-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); }
    .info-item { background: var(--surface); border-radius: var(--radius); padding: var(--spacing-sm); box-shadow: var(--shadow); text-align: center; }
    .info-item .label { color: var(--muted); font-size: 0.9rem; margin-bottom: var(--spacing-sm); }
    .info-item .value { font-size: 1.2rem; font-weight: bold; color: var(--accent); }
    
    .btn { padding: var(--spacing-sm) var(--spacing); background: var(--accent); color: white; border: none; border-radius: var(--radius); cursor: pointer; transition: all 0.2s; text-decoration: none; display: inline-block; }
    .btn:hover { background: var(--accent-hover); }
    .btn.success { background: var(--success); }
    .btn.warning { background: var(--warning); color: var(--text); }
    .btn.danger { background: var(--danger); }
    .btn:disabled { background: var(--muted); cursor: not-allowed; }
    
    .list { list-style: none; }
    .list li { padding: var(--spacing-sm); border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center; }
    .list li:last-child { border-bottom: none; }
    
    .game-record { display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-sm); background: var(--surface); border-radius: var(--radius); margin-bottom: var(--spacing-sm); box-shadow: var(--shadow); }
    .game-record .info { flex: 1; }
    .game-record .info .title { font-weight: bold; margin-bottom: var(--spacing-sm); }
    .game-record .info .meta { color: var(--muted); font-size: 0.9rem; }
    .game-record .result { padding: var(--spacing-sm); border-radius: var(--radius); font-weight: bold; }
    .game-record .result.win { background: var(--success); color: white; }
    .game-record .result.lose { background: var(--danger); color: white; }
    .game-record .result.abort { background: var(--warning); color: var(--text); }
    
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
    .modal.show { display: flex; align-items: center; justify-content: center; }
    .modal-content { background: var(--surface); border-radius: var(--radius-lg); padding: var(--spacing-lg); max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing); }
    .modal-header h3 { margin: 0; }
    .close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--muted); }
    
    .game-canvas { border: 2px solid var(--line); border-radius: var(--radius); margin: var(--spacing) auto; display: block; background: #000; }
    
    .progress-bar { width: 100%; height: 20px; background: var(--line); border-radius: 10px; overflow: hidden; margin: var(--spacing-sm) 0; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--success)); transition: width 0.3s ease; }
    
    .reward-item { display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface); border-radius: var(--radius); margin-bottom: var(--spacing-sm); }
    .reward-icon { font-size: 1.5rem; }
    
    @media (max-width: 768px) {
      .container { padding: var(--spacing-sm); }
      .grid { grid-template-columns: 1fr; }
      .game-info { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🎮 小遊戲系統</h1>
      <p>開始冒險，挑戰各種關卡，獲得豐厚獎勵！</p>
    </div>
    
    <nav class="nav">
      <a href="index.html">🏠 首頁</a>
      <a href="wallet.html">💰 會員錢包</a>
      <a href="signin.html">📅 簽到系統</a>
      <a href="pet.html">🐾 寵物系統</a>
      <a href="minigame.html">🎮 小遊戲</a>
    </nav>
    
    <div class="game-status">
      <h2 id="gameStatus">準備開始冒險</h2>
      <p id="gameStatusDesc">點擊下方按鈕開始新的冒險之旅</p>
    </div>
    
    <div class="game-info">
      <div class="info-item">
        <div class="label">今日剩餘次數</div>
        <div class="value" id="remainingGames">3</div>
      </div>
      <div class="info-item">
        <div class="label">當前關卡</div>
        <div class="value" id="currentLevel">1</div>
      </div>
      <div class="info-item">
        <div class="label">最高紀錄</div>
        <div class="value" id="highScore">15</div>
      </div>
      <div class="info-item">
        <div class="label">總勝利次數</div>
        <div class="value" id="totalWins">8</div>
      </div>
    </div>
    
    <div class="grid">
      <div class="card">
        <h3>🚀 開始冒險</h3>
        <div style="text-align: center; margin-bottom: var(--spacing);">
          <button class="btn success" id="startGameBtn" onclick="startGame()">開始冒險</button>
          <button class="btn danger" id="endGameBtn" onclick="endGame()" style="display: none;">結束冒險</button>
        </div>
        
        <div id="gameInfo" style="display: none;">
          <div class="info-item">
            <div class="label">遊戲ID</div>
            <div class="value" id="sessionId">-</div>
          </div>
          <div class="info-item">
            <div class="label">開始時間</div>
            <div class="value" id="startTime">-</div>
          </div>
          <div class="info-item">
            <div class="label">預估結束時間</div>
            <div class="value" id="endTime">-</div>
          </div>
          <div class="info-item">
            <div class="label">遊戲進度</div>
            <div class="value" id="gameProgress">0%</div>
          </div>
        </div>
        
        <div style="margin-top: var(--spacing);">
          <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 0%;"></div>
          </div>
        </div>
        
        <canvas id="gameCanvas" class="game-canvas" width="400" height="200" style="display: none;"></canvas>
      </div>
      
      <div class="card">
        <h3>🏆 遊戲紀錄</h3>
        <div id="gameRecords">
          <div class="game-record">
            <div class="info">
              <div class="title">冒險 #001</div>
              <div class="meta">2024-09-30 14:30 - 14:45</div>
            </div>
            <div class="result win">勝利</div>
          </div>
          <div class="game-record">
            <div class="info">
              <div class="title">冒險 #002</div>
              <div class="meta">2024-09-29 20:15 - 20:28</div>
            </div>
            <div class="result lose">失敗</div>
          </div>
          <div class="game-record">
            <div class="info">
              <div class="title">冒險 #003</div>
              <div class="meta">2024-09-28 16:45 - 16:52</div>
            </div>
            <div class="result win">勝利</div>
          </div>
          <div class="game-record">
            <div class="info">
              <div class="title">冒險 #004</div>
              <div class="meta">2024-09-27 12:20 - 12:35</div>
            </div>
            <div class="result abort">中止</div>
          </div>
          <div class="game-record">
            <div class="info">
              <div class="title">冒險 #005</div>
              <div class="meta">2024-09-26 18:30 - 18:42</div>
            </div>
            <div class="result win">勝利</div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <h3>🎁 獎勵統計</h3>
        <div id="rewardsStats">
          <div class="reward-item">
            <span class="reward-icon">💰</span>
            <div>
              <strong>總獲得點數</strong><br>
              <small>450 點</small>
            </div>
          </div>
          <div class="reward-item">
            <span class="reward-icon">🐾</span>
            <div>
              <strong>寵物經驗</strong><br>
              <small>120 經驗值</small>
            </div>
          </div>
          <div class="reward-item">
            <span class="reward-icon">🎫</span>
            <div>
              <strong>優惠券</strong><br>
              <small>3 張</small>
            </div>
          </div>
          <div class="reward-item">
            <span class="reward-icon">🏆</span>
            <div>
              <strong>成就徽章</strong><br>
              <small>5 個</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 遊戲結果模態框 -->
  <div id="gameResultModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="resultTitle">遊戲結束</h3>
        <button class="close" onclick="closeGameResult()">&times;</button>
      </div>
      <div id="gameResultContent">
        <!-- 結果內容將由JavaScript生成 -->
      </div>
    </div>
  </div>
  
  <script>
    // 遊戲狀態
    let gameState = {
      isPlaying: false,
      sessionId: null,
      startTime: null,
      endTime: null,
      progress: 0,
      level: 1,
      remainingGames: 3,
      highScore: 15,
      totalWins: 8
    };
    
    // Canvas 遊戲
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let gameAnimation = null;
    let gameObjects = [];
    
    function startGame() {
      if (gameState.remainingGames <= 0) {
        alert('今日遊戲次數已用完！');
        return;
      }
      
      if (gameState.isPlaying) {
        alert('遊戲正在進行中！');
        return;
      }
      
      // 初始化遊戲
      gameState.isPlaying = true;
      gameState.sessionId = 'GAME_' + Date.now();
      gameState.startTime = new Date();
      gameState.endTime = new Date(Date.now() + 15 * 60 * 1000); // 15分鐘後
      gameState.progress = 0;
      
      // 更新UI
      document.getElementById('startGameBtn').style.display = 'none';
      document.getElementById('endGameBtn').style.display = 'inline-block';
      document.getElementById('gameInfo').style.display = 'block';
      document.getElementById('gameCanvas').style.display = 'block';
      
      updateGameInfo();
      startGameAnimation();
      
      // 模擬遊戲進度
      simulateGameProgress();
    }
    
    function endGame() {
      if (!gameState.isPlaying) return;
      
      // 計算結果
      const result = calculateGameResult();
      showGameResult(result);
      
      // 重置遊戲狀態
      gameState.isPlaying = false;
      gameState.remainingGames--;
      
      // 更新UI
      document.getElementById('startGameBtn').style.display = 'inline-block';
      document.getElementById('endGameBtn').style.display = 'none';
      document.getElementById('gameInfo').style.display = 'none';
      document.getElementById('gameCanvas').style.display = 'none';
      
      // 停止動畫
      if (gameAnimation) {
        cancelAnimationFrame(gameAnimation);
        gameAnimation = null;
      }
      
      updateGameInfo();
    }
    
    function updateGameInfo() {
      document.getElementById('remainingGames').textContent = gameState.remainingGames;
      document.getElementById('currentLevel').textContent = gameState.level;
      document.getElementById('highScore').textContent = gameState.highScore;
      document.getElementById('totalWins').textContent = gameState.totalWins;
      
      if (gameState.isPlaying) {
        document.getElementById('sessionId').textContent = gameState.sessionId;
        document.getElementById('startTime').textContent = gameState.startTime.toLocaleTimeString();
        document.getElementById('endTime').textContent = gameState.endTime.toLocaleTimeString();
        document.getElementById('gameProgress').textContent = gameState.progress + '%';
        document.getElementById('progressBar').style.width = gameState.progress + '%';
        
        document.getElementById('gameStatus').textContent = '冒險進行中';
        document.getElementById('gameStatusDesc').textContent = '正在挑戰關卡...';
      } else {
        document.getElementById('gameStatus').textContent = '準備開始冒險';
        document.getElementById('gameStatusDesc').textContent = '點擊下方按鈕開始新的冒險之旅';
      }
    }
    
    function startGameAnimation() {
      // 簡單的遊戲動畫
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 繪製背景
        ctx.fillStyle = '#001122';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 繪製星星
        ctx.fillStyle = '#ffffff';
        for (let i = 0; i < 20; i++) {
          const x = (i * 37) % canvas.width;
          const y = (i * 23) % canvas.height;
          ctx.fillRect(x, y, 2, 2);
        }
        
        // 繪製玩家（簡單的三角形）
        ctx.fillStyle = '#00ff00';
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, canvas.height - 30);
        ctx.lineTo(canvas.width / 2 - 15, canvas.height - 10);
        ctx.lineTo(canvas.width / 2 + 15, canvas.height - 10);
        ctx.closePath();
        ctx.fill();
        
        // 繪製敵人（紅色圓圈）
        ctx.fillStyle = '#ff0000';
        ctx.beginPath();
        ctx.arc(canvas.width / 2 + Math.sin(Date.now() * 0.001) * 50, canvas.height / 2, 10, 0, 2 * Math.PI);
        ctx.fill();
        
        // 繪製進度條
        ctx.fillStyle = '#ffff00';
        ctx.fillRect(10, 10, (gameState.progress / 100) * (canvas.width - 20), 10);
        
        if (gameState.isPlaying) {
          gameAnimation = requestAnimationFrame(animate);
        }
      }
      
      animate();
    }
    
    function simulateGameProgress() {
      const progressInterval = setInterval(() => {
        if (!gameState.isPlaying) {
          clearInterval(progressInterval);
          return;
        }
        
        gameState.progress += Math.random() * 5;
        if (gameState.progress >= 100) {
          gameState.progress = 100;
          clearInterval(progressInterval);
          setTimeout(() => endGame(), 1000);
        }
        
        updateGameInfo();
      }, 1000);
    }
    
    function calculateGameResult() {
      const isWin = Math.random() > 0.3; // 70% 勝率
      const rewards = {
        points: Math.floor(Math.random() * 50) + 20,
        petExp: Math.floor(Math.random() * 20) + 10,
        coupons: Math.random() > 0.7 ? 1 : 0
      };
      
      if (isWin) {
        gameState.totalWins++;
        if (gameState.level > gameState.highScore) {
          gameState.highScore = gameState.level;
        }
      }
      
      return {
        result: isWin ? 'win' : 'lose',
        rewards: rewards,
        level: gameState.level,
        duration: Math.floor((Date.now() - gameState.startTime.getTime()) / 1000)
      };
    }
    
    function showGameResult(result) {
      const titles = {
        'win': '🎉 勝利！',
        'lose': '😢 失敗了',
        'abort': '⏹️ 遊戲中止'
      };
      
      document.getElementById('resultTitle').textContent = titles[result.result];
      
      const rewardsHTML = `
        <div class="reward-item">
          <span class="reward-icon">💰</span>
          <div>
            <strong>獲得點數</strong><br>
            <small>${result.rewards.points} 點</small>
          </div>
        </div>
        <div class="reward-item">
          <span class="reward-icon">🐾</span>
          <div>
            <strong>寵物經驗</strong><br>
            <small>${result.rewards.petExp} 經驗值</small>
          </div>
        </div>
        ${result.rewards.coupons > 0 ? `
        <div class="reward-item">
          <span class="reward-icon">🎫</span>
          <div>
            <strong>優惠券</strong><br>
            <small>${result.rewards.coupons} 張</small>
          </div>
        </div>
        ` : ''}
        <div style="margin-top: var(--spacing); text-align: center;">
          <button class="btn" onclick="closeGameResult()">確定</button>
        </div>
      `;
      
      document.getElementById('gameResultContent').innerHTML = rewardsHTML;
      document.getElementById('gameResultModal').classList.add('show');
    }
    
    function closeGameResult() {
      document.getElementById('gameResultModal').classList.remove('show');
    }
    
    // 初始化
    updateGameInfo();
    
    // 點擊模態框外部關閉
    document.getElementById('gameResultModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeGameResult();
      }
    });
      // 此功能待開發提醒函數
    function showComingSoon() {
      alert("此功能待開發");
    }
  </script>
</body>
</html>

